# ๐ ุชุญุฏูุซ ูุธุงู ุงูุญุฌูุฒุงุช - Admin Panel

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุฑูู ุงููุงุชูุฑุฉ ุงูุชููุงุฆู ๐งพ
- **ุตูุบุฉ**: `INV-YYYYMMDD-XXXXXX`
- **ูุซุงู**: `INV-20241018-000001`
- ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู ููู ุญุฌุฒ ุฌุฏูุฏ
- ุฑูู ูุฑูุฏ ูุง ูุชูุฑุฑ

### 2. ุงูุฑูู ุงููุดูุฑ (ุงูููุฏ ุงูุณุฑู) ๐
- **ุตูุบุฉ**: `RHN-XXXXXXXXXXXX`
- **ูุซุงู**: `RHN-A3F2E9B7C1D4`
- ููุฏ ูุดูุฑ ุจู MD5
- ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู ููู ุญุฌุฒ
- ูููู ุงุณุชุฎุฏุงูู ููุชุญูู ูู ุงูุญุฌุฒ

### 3. ูุนูููุงุช ุงูุนููู ุงููุงููุฉ ๐ค
ูู ููุญุฉ ุงูุชุญููุ ูุธูุฑ ููู ุญุฌุฒ:
- โ ุงุณู ุงูุนููู
- โ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ุฑูู ุงูุฌูุงู
- โ ุชูุงุตูู ุงูุญุฌุฒ ูุงููุฉ

### 4. ุฃุฒุฑุงุฑ ูุจูู/ุฑูุถ ุงูุทูุจุงุช โโ
- **ุฒุฑ ูุจูู**: ูุญูู ุงูุญุงูุฉ ุฅูู "ููุจูู" (confirmed)
- **ุฒุฑ ุฑูุถ**: ูุญูู ุงูุญุงูุฉ ุฅูู "ูุฑููุถ" (rejected)
- ุชุฃููุฏ ูุจู ุชูููุฐ ุฃู ุฅุฌุฑุงุก

### 5. ุชุจููุจุงุช ููุธูุฉ ๐
- **ุฌููุน ุงูุทูุจุงุช**: ุนุฑุถ ูู ุงูุญุฌูุฒุงุช
- **ุทูุจุงุช ูุนููุฉ**: ุงูุญุฌูุฒุงุช ุจุงูุชุธุงุฑ ุงููุจูู/ุงูุฑูุถ
- **ุทูุจุงุช ููุจููุฉ**: ุงูุญุฌูุฒุงุช ุงูููุจููุฉ ููุท

### 6. ุชุตููู ุฌุฏูุฏ ูุงูู ๐จ
- ูุฑูุช ูุจูุฑุฉ ูุน ุฌููุน ุงูุชูุงุตูู
- ุฃููุงู ูููุฒุฉ ููู ุญุงูุฉ
- ุนุฑุถ ุฑูู ุงููุงุชูุฑุฉ ูุงูููุฏ ุจุดูู ูุงุถุญ
- responsive ููุฌูุงู

---

## ๐ง ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุญุฏูุซ Database (ููู!)

ุงูุชุญ Supabase SQL Editor ูููุฐ ุงูู Migration:

```sql
-- ูุณุฎ ูุญุชูู ููู: server/database/migration_add_invoice.sql
```

ุฃู ููุฐ ูุฐุง ุงูู SQL:

```sql
-- 1. ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ
ALTER TABLE bookings 
ADD COLUMN IF NOT EXISTS invoice_number TEXT UNIQUE,
ADD COLUMN IF NOT EXISTS encrypted_code TEXT;

-- 2. ุชุญุฏูุซ status enum
ALTER TABLE bookings DROP CONSTRAINT IF EXISTS bookings_status_check;
ALTER TABLE bookings ADD CONSTRAINT bookings_status_check 
CHECK (status IN ('pending', 'confirmed', 'completed', 'cancelled', 'rejected'));

-- 3. Create sequence
CREATE SEQUENCE IF NOT EXISTS invoice_seq START 1;

-- 4. Functions
CREATE OR REPLACE FUNCTION generate_invoice_number()
RETURNS TEXT AS $$
DECLARE
  invoice_num TEXT;
BEGIN
  SELECT 'INV-' || TO_CHAR(NOW(), 'YYYYMMDD') || '-' || LPAD(NEXTVAL('invoice_seq')::TEXT, 6, '0') INTO invoice_num;
  RETURN invoice_num;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION generate_encrypted_code()
RETURNS TEXT AS $$
BEGIN
  RETURN 'RHN-' || UPPER(SUBSTRING(MD5(RANDOM()::TEXT || NOW()::TEXT) FROM 1 FOR 12));
END;
$$ LANGUAGE plpgsql;

-- 5. Trigger
CREATE OR REPLACE FUNCTION set_booking_codes()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.invoice_number IS NULL THEN
    NEW.invoice_number := generate_invoice_number();
  END IF;
  IF NEW.encrypted_code IS NULL THEN
    NEW.encrypted_code := generate_encrypted_code();
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS bookings_set_codes_trigger ON bookings;
CREATE TRIGGER bookings_set_codes_trigger
  BEFORE INSERT ON bookings
  FOR EACH ROW
  EXECUTE FUNCTION set_booking_codes();

-- 6. ุชุญุฏูุซ ุงูุญุฌูุฒุงุช ุงูููุฌูุฏุฉ
UPDATE bookings 
SET 
  invoice_number = 'INV-' || TO_CHAR(created_at, 'YYYYMMDD') || '-' || LPAD(ROW_NUMBER() OVER (ORDER BY created_at)::TEXT, 6, '0'),
  encrypted_code = 'RHN-' || UPPER(SUBSTRING(MD5(RANDOM()::TEXT || created_at::TEXT) FROM 1 FOR 12))
WHERE invoice_number IS NULL;
```

### 2. ุฅุนุงุฏุฉ ุชุดุบูู Backend

```bash
cd server
npm start
```

### 3. ุฅุนุงุฏุฉ ุชุดุบูู Frontend

```bash
npm run dev
```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุฏูุฑ:

#### 1. ุนุฑุถ ุงูุทูุจุงุช
1. ุงูุชุญ Admin Panel: http://localhost:5173/admin.html
2. ุงุฐูุจ ุฅูู "ุงูุญุฌูุฒุงุช"
3. ุดุงูุฏ ุฌููุน ุงูุทูุจุงุช ูุน ุงูุชูุงุตูู ุงููุงููุฉ

#### 2. ูุจูู ุทูุจ
1. ุงุถุบุท ุนูู **"ูุจูู ุงูุทูุจ"** (ุฒุฑ ุฃุฎุถุฑ)
2. ุชุฃููุฏ ุงููุจูู
3. ุงูุทูุจ ููุชูู ุฅูู "ุทูุจุงุช ููุจููุฉ"

#### 3. ุฑูุถ ุทูุจ
1. ุงุถุบุท ุนูู **"ุฑูุถ ุงูุทูุจ"** (ุฒุฑ ุฃุญูุฑ)
2. ุชุฃููุฏ ุงูุฑูุถ
3. ุงูุทูุจ ูุตุจุญ ุญุงูุชู "ูุฑููุถ"

#### 4. ุงูุชุตููุฉ
- ุงุณุชุฎุฏู ุงูุชุจููุจุงุช ููุชููู ุจูู ุงูุทูุจุงุช
- ุงุณุชุฎุฏู ููุชุฑ ุงูุฎุฏูุงุช ูุนุฑุถ ุฎุฏูุฉ ูุญุฏุฏุฉ

---

## ๐ฏ API Endpoints ุงูุฌุฏูุฏุฉ

### ูุจูู ุญุฌุฒ
```http
POST /api/bookings/:bookingId/accept
Authorization: Bearer {admin_token}
```

**Response:**
```json
{
  "success": true,
  "message": "ุชู ูุจูู ุงูุญุฌุฒ ุจูุฌุงุญ",
  "booking": {
    "id": "...",
    "status": "confirmed",
    "invoice_number": "INV-20241018-000001",
    "encrypted_code": "RHN-A3F2E9B7C1D4",
    "users": {
      "name": "ุฃุญูุฏ ูุญูุฏ",
      "email": "ahmed@example.com",
      "phone": "0512345678"
    }
  }
}
```

### ุฑูุถ ุญุฌุฒ
```http
POST /api/bookings/:bookingId/reject
Authorization: Bearer {admin_token}
```

---

## ๐จ ุงูุดูู ุงูุฌุฏูุฏ

### Card ุงูุชูุงุตูู ุชุนุฑุถ:

**Header:**
- ุญุงูุฉ ุงูุญุฌุฒ (ูููู ุญุณุจ ุงูุญุงูุฉ)
- ุชุงุฑูุฎ ุงูุฅูุดุงุก
- ุฑูู ุงููุงุชูุฑุฉ (ุฐูุจู)
- ุงูููุฏ ุงูุณุฑู (ุฃุฒุฑู)

**ูุนูููุงุช ุงูุนููู:**
- ุงูุงุณู
- ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฑูู ุงูุฌูุงู

**ุชูุงุตูู ุงูุญุฌุฒ:**
- ุงุณู ุงูุฎุฏูุฉ
- ุงูุชุงุฑูุฎ ูุงูููุช
- ุงูุณุนุฑ
- ุงูููุงุญุธุงุช (ุฅู ูุฌุฏุช)

**ุงูุฃุฒุฑุงุฑ:**
- ูุจูู (ุฃุฎุถุฑ) - ููุทูุจุงุช ุงููุนููุฉ
- ุฑูุถ (ุฃุญูุฑ) - ููุทูุจุงุช ุงููุนููุฉ
- ุญุฐู (ุฑูุงุฏู)

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ุฑูู ุงููุงุชูุฑุฉ:
- ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู
- ุตูุบุชู: `INV-{ุชุงุฑูุฎ}-{ุฑูู ูุชุณูุณู}`
- ูุฑูุฏ ููุง ูุชูุฑุฑ
- ููุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. ุงูููุฏ ุงููุดูุฑ:
- ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู
- ูุดูุฑ ุจู MD5
- ุทููู 12 ุญุฑู (ุจุนุฏ RHN-)
- ูููู ุงุณุชุฎุฏุงูู ููุชุญูู ูู ุงูุญุฌุฒ

### 3. ุงูุญุงูุงุช ุงููุชุงุญุฉ:
- **pending**: ูุนูู (ุจุงูุชุธุงุฑ ุงููุฑุงุฑ)
- **confirmed**: ููุจูู โ
- **rejected**: ูุฑููุถ โ
- **completed**: ููุชูู
- **cancelled**: ููุบู

### 4. ุงูุชุตููุฉ:
- ุงูุชุจููุจุงุช ุชุนูู ุนูู ุงูุฌูุฉ ุงูุฃูุงููุฉ (frontend)
- ููุชุฑ ุงูุฎุฏูุงุช ูุนูู ุนูู ุงูุฌูุฉ ุงูุฎูููุฉ (backend)

---

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ: "ุฑูู ุงููุงุชูุฑุฉ ูุง ูุธูุฑ"
**ุงูุญู**: 
1. ุชุฃูุฏ ูู ุชูููุฐ SQL Migration
2. ุฃุนุฏ ุชุดุบูู Backend Server
3. ุฃูุดุฆ ุญุฌุฒ ุฌุฏูุฏ ููุงุฎุชุจุงุฑ

### ุงููุดููุฉ: "ุฃุฒุฑุงุฑ ูุจูู/ุฑูุถ ูุง ุชุนูู"
**ุงูุญู**:
1. ุชุฃูุฏ ูู ุชุดุบูู Backend Server
2. ุงูุชุญ Console ุงููุชุตูุญ ููุฃุฎุทุงุก
3. ุชุฃูุฏ ูู ุตูุงุญูุงุช Admin

### ุงููุดููุฉ: "ูุนูููุงุช ุงููุณุชุฎุฏู ูุง ุชุธูุฑ"
**ุงูุญู**:
1. ุชุญูู ูู ูุฌูุฏ ุฌุฏูู users
2. ุชุฃูุฏ ูู ุงูุนูุงูุฉ ุจูู bookings ู users

---

## โ Checklist

ูุจู ุงูุจุฏุก:
- [ ] ุชูููุฐ SQL Migration ูู Supabase
- [ ] ุฅุนุงุฏุฉ ุชุดุบูู Backend Server
- [ ] ุฅุนุงุฏุฉ ุชุดุบูู Frontend
- [ ] ุงุฎุชุจุงุฑ ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ
- [ ] ุงูุชุญูู ูู ุธููุฑ ุฑูู ุงููุงุชูุฑุฉ ูุงูููุฏ
- [ ] ุงุฎุชุจุงุฑ ุฃุฒุฑุงุฑ ูุจูู/ุฑูุถ

---

## ๐ ุชู ุจุญูุฏ ุงููู!

ุงููุธุงู ุงูุขู ูุนุฑุถ:
- โ ุฑูู ูุงุชูุฑุฉ ููู ุญุฌุฒ
- โ ููุฏ ุณุฑู ูุดูุฑ
- โ ูุนูููุงุช ุงูุนููู ูุงููุฉ
- โ ุฃุฒุฑุงุฑ ูุจูู/ุฑูุถ
- โ ุชุจููุจุงุช ููุธูุฉ
- โ ุชุตููู ุงุญุชุฑุงูู

**ุงุณุชูุชุน ุจุงูุงุณุชุฎุฏุงู! ๐**

